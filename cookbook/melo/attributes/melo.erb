<?xml version="1.0" encoding="UTF-8" ?>
<Context>
    <Resource name="config/meloJNDIConfig"
              auth="Container"
              type="cbp.util.core.jndi.Config"
              factory="cbp.util.core.jndi.ConfigFactory"
              jndiUrlProvider="file:///<%= node['tomcat_latest']['tomcat_install_loc'] %>/tomcat/conf"
              clavisUrlLogin="<%= node['cbp']['clavis']['clavisUrlLogin'] %>"
              clavisCrowdAppName="<%= node['cbp']['crowd']['user']['fare'] %>"
              clavisCrowdAppPassword="<%= node['cbp']['crowd']['password']['fare'] %>"
              urlServicesClavisLogin="<%= node['cbp']['services']['clavislogin']['uri'] %>"
              urlServicesPieces="<%= node['cbp']['services']['piece']['uri'] %>"
              urlServicesEdition="<%= node['cbp']['services']['editionint']['uri'] %>"
              urlServicesDistributeur="<%= node['cbp']['services']['distributeur']['uri'] %>"
              urlServicesZurix="<%= node['cbp']['services']['zurix']['uri'] %>"
              urlServicesMandatSepa="<%= node['cbp']['services']['mandatsepa']['uri']%>"
              urlServicesSocle="<%= node['cbp']['services']['socle']['uri']%>"
              urlServicesProduit="<%= node['cbp']['services']['referentiel-produit-int']['uri']%>"
              urlServicesMoni="<%= node['cbp']['services']['moni-int']['uri']%>"
              urlServicesInocs="<%= node['cbp']['services']['inocs']['uri']%>"
              urlServicesIndexInocs="http://<%=node['cbp']['elasticsearch']['metier']%>/inocs-<%=node['cbp']['environnement'].downcase%>-1/_settings"
            />

    <Resource name="jdbc/fareDB2400Pool"
              auth="Container"
              type="javax.sql.DataSource"
              username="<%= node['cbp']['bdd']['user']['inocs-fare']%>"
              password="<%= node['cbp']['bdd']['password']['inocs-fare']%>"
              driverClassName="com.ibm.as400.access.AS400JDBCDriver"
              url="jdbc:as400://<%= node['cbp']['as400']['name'] %>;prompt=false;naming=system;date format=iso;extended dynamic=false;package=jbpkg;package cache=false;errors=basic"
              timeBetweenEvictionRunsMillis="5000"
              minEvictableIdleTimeMillis="60000"
              validationQuery="select 1 from sysibm.sysdummy1"
              validationQueryTimeout="3"
              validationInterval="15000"
              testOnBorrow="true"
              testWhileIdle="true"
              testOnReturn="false"
              ignoreExceptionOnPreLoad="true"
              abandonWhenPercentageFull="100"
              removeAbandonedTimeout="120000"
              removeAbandoned="true"
              logAbandoned="false"
              jmxEnabled="true"
              defaultTransactionIsolation="READ_COMMITTED"
            />

    <Resource name="jdbc/personneProductionDB2400Pool"
              auth="Container"
              type="javax.sql.DataSource"
              username="<%= node['cbp']['bdd']['user']['personne']%>"
              password="<%= node['cbp']['bdd']['password']['personne']%>"
              driverClassName="com.ibm.as400.access.AS400JDBCDriver"
              url="jdbc:as400://<%= node['cbp']['as400']['name'] %>;prompt=false;naming=system;date format=iso;extended dynamic=false;package=jbpkg;package cache=false;errors=basic"
              timeBetweenEvictionRunsMillis="5000"
              minEvictableIdleTimeMillis="60000"
              validationQuery="select 1 from sysibm.sysdummy1"
              validationQueryTimeout="3"
              validationInterval="15000"
              testOnBorrow="true"
              testWhileIdle="true"
              testOnReturn="false"
              ignoreExceptionOnPreLoad="true"
              abandonWhenPercentageFull="100"
              removeAbandonedTimeout="120000"
              removeAbandoned="true"
              logAbandoned="false"
              jmxEnabled="true"
              defaultTransactionIsolation="READ_COMMITTED"
            />

    <Resource name="jdbc/echangesProductionDB2400Pool"
              auth="Container"
              type="javax.sql.DataSource"
              username="<%= node['cbp']['bdd']['user']['echanges-production']%>"
              password="<%= node['cbp']['bdd']['password']['echanges-production']%>"
              driverClassName="com.ibm.as400.access.AS400JDBCDriver"
              url="jdbc:as400://<%= node['cbp']['as400']['name'] %>;prompt=false;naming=system;date format=iso;extended dynamic=false;package=jbpkg;package cache=false;errors=basic"
              timeBetweenEvictionRunsMillis="5000"
              minEvictableIdleTimeMillis="60000"
              validationQuery="select 1 from sysibm.sysdummy1"
              validationQueryTimeout="3"
              validationInterval="15000"
              testOnBorrow="true"
              testWhileIdle="true"
              testOnReturn="false"
              ignoreExceptionOnPreLoad="true"
              abandonWhenPercentageFull="100"
              removeAbandonedTimeout="120000"
              removeAbandoned="true"
              logAbandoned="false"
              jmxEnabled="true"
              defaultTransactionIsolation="READ_COMMITTED"
            />

</Context>